{% extends 'frontend/base3.html' %}
{% load static %}
{% block content %}
{% if messages %}
{% for message in messages %}
<script>
    notify('{{message.level_tag}}', "{{message}}");
</script>

{% endfor %}

{% endif %}
<div class="row">
    <div class="col-sm-12">
        <div class="card mb-4 ">
            <div class="text-center mb-4">
                <h2 class="fw-bold text-primary">Search Results</h2>
                <p class="text-muted">Based on the information you provided,
                    hereâ€™s your AI-generated results:</p>
            </div>
        </div>
    </div>

</div>
<div class="row">
    <div class="col-lg-12">

        <!-- <div class="card mb-4 shadow-sm">
            <div class="card-header bg-info text-white">
                Search information
            </div>
            <div class="card-body" style="text-align: justify;">
                <p>{{results.information}}</p>
            </div>
        </div> -->

        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-success text-white">
                Recipe for :{{results.information}}
            </div>
            <div class="card-body">
                {% if results.results %}
                <ul class="list-group list-group-flush">
                    <li class="list-group-item" style="text-align: justify;">
                        {{results.results|safe}}</li>

                </ul>
                {% else %}
                <p class="text-muted">No Recipe
                    available.</p>
                {% endif %}
            </div>
        </div>

        <!-- <div class="card mb-4 shadow-sm">
            <div class="card-header bg-secondary text-white">
                Recommended Institutions Near You
            </div>
            <div class="card-body">
                {% if institutions %}
                <div class="list-group">
                    {% for item in institutions %}
                    <div class="list-group-item">
                        <h6 class="mb-1 fw-bold"><b>Name</b>:
                            {{item.name}}
                        </h6>
                        <p class="mb-1"><i class="bi bi-geo-alt"></i>
                            <b>Email</b>: {{item.email}}
                        </p>
                        <p class="mb-1"><i class="bi bi-telephone"></i>
                            <b>Phone</b>: {{item.phone}}</small>
                        </p>
                        <p class="mb-1">

                            <i class="bi bi-telephone"></i>
                            <b>Emergency</b>
                            :{{item.emergency}}</small>

                        </p>
                        <p class="mb-1">

                            <i class="bi bi-telephone"></i>
                            <b>Distance</b>
                            :{{item.distance}}Km</small>

                        </p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-muted">No Institutions available in your
                    area.</p>
                {% endif %}
            </div>
    </div> -->

        <!-- Back Button -->


    </div>
    <!-- <div class="col-lg-12">
        <div class="card mb-4 shadow-sm">
            <div class="card-header bg-warning text-dark">
                Suggestions
            </div>
            <div class="card-body">
                {% if results.suggestions %}
                <ul class="list-group list-group-flush">

                    <li class="list-group-item" style="text-align: justify;">
                        {{results.suggestions|safe}}
                    </li>

                </ul>
                {% else %}
                <p class="text-muted">No Suggestions
                    available.</p>
                {% endif %}
            </div>
        </div>

        <!-- <link rel="stylesheet"
            href="https://unpkg.com/leaflet/dist/leaflet.css" />
        <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

        <div class="card mt-3 shadow-sm">
            <div class="card-body">
                <h5 class="card-title">Nearby Institutions on Map</h5>
                <div id="map" data='{{institutions|escapejs}}'
                    style="height: 400px; border-radius: 10px;"></div>
            </div>
        </div> -->

</div>
<div class="col-sm-12">
    <div class="d-flex justify-content-between">
        <a href="{% url 'search' %}" class="btn btn-primary">
            New Career
        </a>
        <a href="{% url 'dashboard' %}" class="btn btn-primary">
            Back to Dashboard
        </a>
    </div>
</div>
</div>

<script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var mapDiv = document.getElementById('map');

        if (!mapDiv) return; // Safety check

        // Parse JSON from data attribute
        var clinics = JSON.parse(mapDiv.getAttribute('data'));

        // Get user location from data attributes and ensure numbers
        var userLat = parseFloat(mapDiv.getAttribute('data-lat'));
        var userLon = parseFloat(mapDiv.getAttribute('data-lon'));

        // Initialize map
        var map = L.map('map').setView([userLat, userLon], 14);

        // Add OpenStreetMap tiles
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);

        // Add user marker
        var userMarker = L.marker([userLat, userLon]).addTo(map)
            .bindPopup("<b>You are here</b>").openPopup();

        // Add clinic markers
        clinics.forEach(function (clinic) {
            L.marker([clinic.lat, clinic.lon]).addTo(map)
                .bindPopup("<b>" + clinic.name + "</b><br/>Distance: " + clinic.distance + " km");
        });

        // Fit map to all markers
        var group = new L.featureGroup(
            [userMarker].concat(clinics.map(c => L.marker([c.lat, c.lon])))
        );
        map.fitBounds(group.getBounds());
    });
</script>


{% endblock %}